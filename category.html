<html lang="km">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ប្រភេទផលិតផល - Product Categories</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts for Battambang and Roboto -->
    <link
        href="https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&amp;family=Roboto:wght@300;400;500;700&amp;display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <style>
        /* Custom styles for body and buttons */
        body {
            font-family: 'Battambang', 'Roboto', sans-serif;
            background-color: #f8f9fa;
        }

        .btn-primary {
            background-color: #3B82F6;
            color: white;
        }

        .btn-secondary {
            background-color: #64748B;
            color: white;
        }

        /* Category card hover effect */
        .category-card {
            transition: transform 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-5px);
        }

        /* Product card hover effect */
        .product-card {
            transition: all 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Badges for B2B/B2C */
        .badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-b2b {
            background-color: #64748B;
            color: white;
        }

        .badge-b2c {
            background-color: #3B82F6;
            color: white;
        }

        /* Modal transition effect */
        .modal {
            transition: opacity 0.3s ease;
        }

        /* Custom scrollbar styles for webkit browsers */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #3B82F6;
            border-radius: 10px;
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white shadow-md">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <!-- Logo -->
                <div class="flex items-center">
                    <svg class="h-10 w-10 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                        </path>
                    </svg>
                    <span class="ml-2 text-xl font-bold text-gray-800">គ្រឿងសំណង់</span>
                </div>

                <!-- Language Toggle -->
                <div class="flex items-center">
                    <button id="langToggle"
                        class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded-full text-gray-700 mr-2">
                        <span id="currentLang">ខ្មែរ</span> / <span class="text-gray-400">Eng</span>
                    </button>
                    <button id="searchBtn" class="p-2 mr-2 text-gray-600">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                    <button id="cartBtn" class="p-2 mr-2 text-gray-600 relative">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
                            </path>
                        </svg>
                        <span id="cartCount"
                            class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                    <button id="userBtn" class="p-2 text-gray-600">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Search Bar (Hidden by default) -->
            <div id="searchBar" class="mt-3 hidden">
                <div class="relative">
                    <input type="text" placeholder="ស្វែងរកផលិតផល... / Search products..."
                        class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        id="searchInput">
                    <button class="absolute right-3 top-3 text-gray-500">
                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        

        <!-- Customer Type Selector -->
        

        <!-- Categories -->
        <section class="mb-8">
            <h2 class="text-xl font-bold mb-4" data-km="ប្រភេទផលិតផល" data-en="Product Categories">ប្រភេទផលិតផល</h2>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-4" id="categoriesContainer">
                <!-- Category cards are static for now, dynamic if needed -->
                <div class="category-card bg-white rounded-lg shadow p-4 text-center cursor-pointer"
                    data-category="cement">
                    <div class="bg-blue-100 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-3">
                        <svg class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                            </path>
                        </svg>
                    </div>
                    <h3 class="font-medium" data-km="សុីម៉ងត៍" data-en="Cement">សុីម៉ងត៍</h3>
                </div>
                <div class="category-card bg-white rounded-lg shadow p-4 text-center cursor-pointer"
                    data-category="bricks">
                    <div class="bg-red-100 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-3">
                        <svg class="h-8 w-8 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                            </path>
                        </svg>
                    </div>
                    <h3 class="font-medium" data-km="ឥដ្ឋ" data-en="Bricks">ឥដ្ឋ</h3>
                </div>
                <div class="category-card bg-white rounded-lg shadow p-4 text-center cursor-pointer"
                    data-category="tools">
                    <div class="bg-yellow-100 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-3">
                        <svg class="h-8 w-8 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                            </path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </div>
                    <h3 class="font-medium" data-km="ឧបករណ៍" data-en="Tools">ឧបករណ៍</h3>
                </div>
                <div class="category-card bg-white rounded-lg shadow p-4 text-center cursor-pointer"
                    data-category="steel">
                    <div class="bg-green-100 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-3">
                        <svg class="h-8 w-8 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z">
                            </path>
                        </svg>
                    </div>
                    <h3 class="font-medium" data-km="ដែក" data-en="Steel">ដែក</h3>
                </div>
                <div class="category-card bg-white rounded-lg shadow p-4 text-center cursor-pointer"
                    data-category="fabric">
                    <div class="bg-purple-100 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-3">
                        <svg class="h-8 w-8 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"></path>
                        </svg>
                    </div>
                    <h3 class="font-medium" data-km="ក្រណាត់" data-en="Fabric">ក្រណាត់</h3>
                </div>
                <div class="category-card bg-white rounded-lg shadow p-4 text-center cursor-pointer"
                    data-category="other">
                    <div class="bg-indigo-100 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-3">
                        <svg class="h-8 w-8 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z">
                            </path>
                        </svg>
                    </div>
                    <h3 class="font-medium" data-km="ផ្សេងៗ" data-en="Others">ផ្សេងៗ</h3>
                </div>
            </div>
        </section>

        
                <div class="product-card bg-white rounded-lg shadow overflow-hidden relative cursor-pointer"
                    data-id="s1" data-name-km="ដែកម៉ាក់" data-name-en="Thai Steel" data-price="12.75"
                    data-spec="12mm x 12m" data-image="images/Metal.jpg"
                    data-description-km="ដែកម៉ាកថៃដែលមានគុណភាពល្អបំផុត ប្រើប្រាស់សម្រាប់គ្រឹះសំណង់ និងការងារទូទៅ។"
                    data-description-en="Top quality Thai Steel, used for building foundations and general construction.">
                    <span class="badge badge-b2b">B2B</span>
                    <div class="h-40 bg-gray-200 flex items-center justify-center">
                        <img src="images/Metal.jpg" alt="Product Image" class="w-full h-full object-cover">
                    </div>
                    <div class="p-4">
                        <h3 class="font-medium mb-1" data-km="ដែកម៉ាក់" data-en="Thai Steel">ដែកម៉ាក់</h3>
                        <p class="text-gray-500 text-sm mb-2">12mm x 12m</p>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-blue-500">$12.75</span>
                            <button class="add-to-cart bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-full"
                                data-id="s1" data-name="ដែកម៉ាក់" data-name-en="Thai Steel" data-price="12.75">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="product-card bg-white rounded-lg shadow overflow-hidden relative cursor-pointer"
                    data-id="t1" data-name-km="ឧបករណ៍ជាង" data-name-en="Tool Set" data-price="45.00"
                    data-spec="ឈុតគ្រឿង 10 (10-piece set)" data-image="images/things.jpg"
                    data-description-km="ឈុតឧបករណ៍ជាង 10 មុខ គុណភាពល្អ ងាយស្រួលប្រើប្រាស់សម្រាប់ជាងគ្រប់រូប។"
                    data-description-en="10-piece tool set, good quality, easy to use for all craftsmen.">
                    <span class="badge badge-b2c">B2C</span>
                    <div class="h-40 bg-gray-200 flex items-center justify-center">
                        <img src="images/things.jpg" alt="Product Image" class="w-full h-full object-cover">
                    </div>
                    <div class="p-4">
                        <h3 class="font-medium mb-1" data-km="ឧបករណ៍ជាង" data-en="Tool Set">ឧបករណ៍ជាង</h3>
                        <p class="text-gray-500 text-sm mb-2" data-km="ឈុតគ្រឿង 10" data-en="10-piece set">ឈុតគ្រឿង 10
                        </p>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-blue-500">$45.00</span>
                            <button class="add-to-cart bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-full"
                                data-id="t1" data-name="ឧបករណ៍ជាង" data-name-en="Tool Set" data-price="45.00">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="product-card bg-white rounded-lg shadow overflow-hidden relative cursor-pointer"
                    data-id="o1" data-name-km="ក្បឿងដំបូល" data-name-en="Roof Tiles" data-price="5.25"
                    data-spec="1m x 2m" data-image="images/roof.jpg"
                    data-description-km="ក្បឿងដំបូលធន់នឹងអាកាសធាតុ ផ្តល់ភាពត្រជាក់ និងសោភ័ណភាពសម្រាប់លំនៅដ្ឋាន។"
                    data-description-en="Weather-resistant roof tiles, providing coolness and aesthetics for homes.">
                    <span class="badge badge-b2b">B2B</span>
                    <div class="h-40 bg-gray-200 flex items-center justify-center">
                        <img src="images/roof.jpg" alt="Product Image" class="w-full h-full object-cover">
                    </div>
                    <div class="p-4">
                        <h3 class="font-medium mb-1" data-km="ក្បឿងដំបូល" data-en="Roof Tiles">ក្បឿងដំបូល</h3>
                        <p class="text-gray-500 text-sm mb-2">1m x 2m</p>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-blue-500">$5.25</span>
                            <button class="add-to-cart bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-full"
                                data-id="o1" data-name="ក្បឿងដំបូល" data-name-en="Roof Tiles" data-price="5.25">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

       
        <!-- Group Members Section End -->

        <footer class="bg-gray-800 text-white py-4 mt-4">
            <!-- Reduced vertical padding (py-6 to py-4) and top margin (mt-6 to mt-4) for a smaller footprint -->
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8">
                    <!-- Company Info -->
                    <div class="md:text-left"> <!-- Removed text-center to ensure left alignment on all screen sizes -->
                        <h3 class="text-xl font-bold mb-2">គ្រឿងសំណង់</h3>
                        <!-- Adjusted mb-3 to mb-2 for tighter spacing -->
                        <p class="text-gray-400 text-sm leading-relaxed">
                            Providing high-quality construction materials for all your project needs.
                        </p>
                        <p class="text-gray-400 text-xs mt-2">
                            © 2024 Construction Materials. All rights reserved.
                        </p>
                    </div>

                    <!-- Quick Links -->
                    <div class="md:text-left"> <!-- Removed text-center to ensure left alignment on all screen sizes -->
                        <h3 class="text-lg font-semibold mb-2">Quick Links</h3>
                        <!-- Adjusted mb-3 to mb-2 for tighter spacing -->
                        <ul class="space-y-1">
                            <li><a href="#"
                                    class="text-gray-400 hover:text-blue-400 transition-colors duration-200 text-sm">Home</a>
                            </li>
                            <li><a href="#"
                                    class="text-gray-400 hover:text-blue-400 transition-colors duration-200 text-sm">Categories</a>
                            </li>
                            <li><a href="#"
                                    class="text-gray-400 hover:text-blue-400 transition-colors duration-200 text-sm">Products</a>
                            </li>
                            <li><a href="#"
                                    class="text-gray-400 hover:text-blue-400 transition-colors duration-200 text-sm">Contact
                                    Us</a></li>
                            <li><a href="#"
                                    class="text-gray-400 hover:text-blue-400 transition-colors duration-200 text-sm">About
                                    Us</a></li>
                        </ul>
                    </div>

                    <!-- Contact Info -->
                    <div class="md:text-left">
                        <!-- Removed text-center and justify-center to ensure left alignment on all screen sizes -->
                        <h3 class="text-lg font-semibold mb-2">Contact Us</h3>
                        <!-- Adjusted mb-3 to mb-2 for tighter spacing -->
                        <p class="text-gray-400 text-sm flex items-center mb-1"> <!-- Removed justify-center -->
                            <svg class="h-4 w-4 text-gray-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.828 0l-4.243-4.243a8 8 0 1111.314 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            123 Main Street, Phnom Penh, Cambodia
                        </p>
                        <p class="text-gray-400 text-sm flex items-center mb-1"> <!-- Removed justify-center -->
                            <svg class="h-4 w-4 text-gray-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                            </svg>
                            (855) 12 345 678
                        </p>
                        <p class="text-gray-400 text-sm flex items-center"> <!-- Removed justify-center -->
                            <svg class="h-4 w-4 text-gray-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                            info@construction.com
                        </p>
                    </div>
                </div>
            </div>
        </footer>

    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-gray-200 z-40">
        <div class="flex justify-around">
            <a href="index.html" class="flex flex-col items-center py-2 px-3 text-blue-500">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                    </path>
                </svg>
                <span class="text-xs mt-1" data-km="ទំព័រដើម" data-en="Home">ទំព័រដើម</span>
            </a>
            <a href="category.html" class="flex flex-col items-center py-2 px-3 text-gray-500" id="categoriesNavBtn">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z">
                    </path>
                </svg>
                <span class="text-xs mt-1" data-km="ប្រភេទ" data-en="Categories">ប្រភេទ</span>
            </a>
            <a href="product.html" class="flex flex-col items-center py-2 px-3 text-gray-500" id="categoriesNavBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z" />
                </svg>

                <span class="text-xs mt-1" data-km="ផលិតផល" data-en="Products">ផលិតផល</span>
            </a>
            <a href="#" class="flex flex-col items-center py-2 px-3 text-gray-500" id="cartNavBtn">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
                    </path>
                </svg>
                <span class="text-xs mt-1" data-km="កន្ត្រក" data-en="Cart">កន្ត្រក</span>
            </a>
            <a href="#" class="flex flex-col items-center py-2 px-3 text-gray-500" id="accountNavBtn">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <span class="text-xs mt-1" data-km="គណនី" data-en="Account">គណនី</span>
            </a>
        </div>
    </nav>

    <!-- Notification Container (for custom alerts) -->
    <div id="notificationContainer"
        class="fixed top-4 right-4 z-[100] flex flex-col items-end space-y-2 pointer-events-none">
        <!-- Notifications will be appended here -->
    </div>

    <!-- Login Modal -->
    <div id="loginModal"
        class="modal fixed inset-0 bg-black bg-opacity-10 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-md mx-auto overflow-hidden">
            <div class="bg-blue-500 text-white py-4 px-6 flex justify-between items-center">
                <h3 class="text-xl font-bold" data-km="ចូលគណនី" data-en="Login">ចូលគណនី</h3>
                <button class="close-modal-btn text-white" data-modal="loginModal">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="username">
                        <span data-km="ឈ្មោះអ្នកប្រើប្រាស់" data-en="Username">ឈ្មោះអ្នកប្រើប្រាស់</span>
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                        id="username" type="text" placeholder="user">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="password">
                        <span data-km="លេខសម្ងាត់" data-en="Password">លេខសម្ងាត់</span>
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                        id="password" type="password" placeholder="123">
                </div>
                <div class="flex items-center justify-between mb-4">
                    <button id="loginBtn"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full"
                        data-km="ចូលគណនី" data-en="Login">
                        ចូលគណនី
                    </button>
                </div>
                <div class="text-center">
                    <a href="#" class="text-blue-500 hover:text-blue-700 text-sm" data-km="ភ្លេចលេខសម្ងាត់?"
                        data-en="Forgot Password?">ភ្លេចលេខសម្ងាត់?</a>
                    <p class="mt-4 text-gray-600 text-sm">
                        <span data-km="មិនទាន់មានគណនី?" data-en="Don't have an account?">មិនទាន់មានគណនី?</span>
                        <a href="#" id="showRegisterBtn" class="text-blue-500 hover:text-blue-700" data-km="ចុះឈ្មោះ"
                            data-en="Register">ចុះឈ្មោះ</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal"
        class="modal fixed inset-0 bg-black bg-opacity-10 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-md mx-auto overflow-hidden">
            <div class="bg-gray-700 text-white py-4 px-6 flex justify-between items-center">
                <h3 class="text-xl font-bold" data-km="បង្កើតគណនីថ្មី" data-en="Create New Account">បង្កើតគណនីថ្មី</h3>
                <button class="close-modal-btn text-white" data-modal="registerModal">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="fullName">
                        <span data-km="ឈ្មោះពេញ" data-en="Full Name">ឈ្មោះពេញ</span>
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                        id="fullName" type="text" placeholder="John Doe">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="phoneNumber">
                        <span data-km="លេខទូរស័ព្ទ" data-en="Phone Number">លេខទូរស័ព្ទ</span>
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                        id="phoneNumber" type="text" placeholder="012 345 678">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="regEmail">
                        <span data-km="អ៊ីមែល" data-en="Email">អ៊ីមែល</span>
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                        id="regEmail" type="email" placeholder="example@email.com">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="regPassword">
                        <span data-km="លេខសម្ងាត់" data-en="Password">លេខសម្ងាត់</span>
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                        id="regPassword" type="password" placeholder="********">
                </div>
                <div class="mb-6">
                    <label class="flex items-center">
                        <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="ml-2 text-gray-700 text-sm">
                            <span data-km="ខ្ញុំយល់ព្រមនឹង" data-en="I agree to the">ខ្ញុំយល់ព្រមនឹង</span>
                            <a href="#" class="text-blue-500" data-km="លក្ខខណ្ឌ" data-en="Terms">លក្ខខណ្ឌ</a>
                            <span data-km="និង" data-en="and">និង</span>
                            <a href="#" class="text-blue-500" data-km="គោលការណ៍ឯកជនភាព"
                                data-en="Privacy Policy">គោលការណ៍ឯកជនភាព</a>
                        </span>
                    </label>
                </div>
                <div class="flex items-center justify-between mb-4">
                    <button id="registerBtn"
                        class="bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full"
                        data-km="ចុះឈ្មោះ" data-en="Register">
                        ចុះឈ្មោះ
                    </button>
                </div>
                <div class="text-center">
                    <p class="text-gray-600 text-sm">
                        <span data-km="មានគណនីរួចហើយ?" data-en="Already have an account?">មានគណនីរួចហើយ?</span>
                        <a href="#" id="showLoginBtn" class="text-blue-500 hover:text-blue-700" data-km="ចូលគណនី"
                            data-en="Login">ចូលគណនី</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal fixed inset-0 bg-black bg-opacity-10 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-md mx-auto overflow-hidden max-h-[90vh] flex flex-col">
            <div class="bg-blue-500 text-white py-4 px-6 flex justify-between items-center">
                <h3 class="text-xl font-bold" data-km="កន្ត្រកទំនិញ" data-en="Shopping Cart">កន្ត្រកទំនិញ</h3>
                <button class="close-modal-btn text-white" data-modal="cartModal">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div class="p-6 overflow-y-auto flex-grow" id="cartItems">
                <div class="text-center text-gray-500 py-8" id="emptyCart">
                    <svg class="h-16 w-16 mx-auto text-gray-300 mb-4" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
                        </path>
                    </svg>
                    <p data-km="កន្ត្រកទំនេរ" data-en="Cart is empty">កន្ត្រកទំនេរ</p>
                </div>
                <!-- Cart items will be added here dynamically -->
            </div>
            <div class="border-t border-gray-200 p-6">
                <div class="flex justify-between mb-4">
                    <span class="font-bold" data-km="សរុប:" data-en="Total:">សរុប:</span>
                    <span class="font-bold text-blue-500" id="cartTotal">$0.00</span>
                </div>
                <button id="checkoutBtn"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded focus:outline-none focus:shadow-outline w-full disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled="" data-km="បញ្ជាទិញ" data-en="Checkout">
                    បញ្ជាទិញ
                </button>
                <p class="text-center text-gray-500 text-sm mt-2" data-km="មជ្ឈមណ្ឌលទូរស័ព្វនឹងទាក់ទងអ្នកដើម្បីបញ្ជាក់"
                    data-en="Call center will contact you to confirm">មជ្ឈមណ្ឌលទូរស័ព្ទនឹងទាក់ទងអ្នកដើម្បីបញ្ជាក់</p>
            </div>
        </div>
    </div>

    <!-- Checkout Success Modal -->
    <div id="checkoutSuccessModal"
        class="modal fixed inset-0 bg-black bg-opacity-10 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-md mx-auto overflow-hidden">
            <div class="p-6 text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="h-10 w-10 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold mb-2" data-km="បញ្ជាទិញបានជោគជ័យ!" data-en="Order Successful!">
                    បញ្ជាទិញបានជោគជ័យ!</h3>
                <p class="text-gray-600 mb-4"
                    data-km="អរគុណសម្រាប់ការបញ្ជាទិញ។ មជ្ឈមណ្ឌលទូរស័ព្ទនឹងទាក់ទងអ្នកក្នុងពេលឆាប់ៗនេះ។"
                    data-en="Thank you for your order. Our call center will contact you shortly.">
                    អរគុណសម្រាប់ការបញ្ជាទិញ។ មជ្ឈមណ្ឌលទូរស័ព្pនឹងទាក់ទងអ្នកដើម្បីបញ្ជាក់</p>
                <button id="continueShoppingBtn"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                    data-km="បន្តការទិញទំនិញ" data-en="Continue Shopping">
                    បន្តការទិញទំនិញ
                </button>
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="productDetailModal"
        class="modal fixed inset-0 bg-black bg-opacity-10 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-md mx-auto overflow-hidden max-h-[90vh] flex flex-col">
            <div class="bg-blue-500 text-white py-4 px-6 flex justify-between items-center">
                <h3 class="text-xl font-bold" id="productDetailTitle">Product Details</h3>
                <button class="close-modal-btn text-white" data-modal="productDetailModal">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <!-- Main content area of the modal -->
            <div class="p-0 overflow-y-auto flex-grow" id="productDetailContent">
                <!-- Product Image Section (to show full pic) -->
                <div class="h-60 bg-gray-200 flex items-center justify-center relative overflow-hidden">
                    <!-- This image will be updated dynamically -->
                    <img id="modalProductMainImage" src="" alt="Product Main Image" class="w-full h-full object-cover">
                </div>

                <!-- Other Product Details Text (with padding applied here) -->
                <div class="p-6">
                    <h4 class="font-medium mb-1 text-lg" id="modalProductName"></h4>
                    <p class="text-gray-500 text-sm mb-2" id="modalProductSpec"></p>
                    <p class="text-gray-700 mb-4" id="modalProductDescription"></p>
                    <!-- Add more details dynamically as needed (e.g., brand, weight, etc.) -->
                </div>
            </div>
            <!-- Modal Footer -->
            <div class="border-t border-gray-200 p-6 flex justify-between">
                <span class="font-bold text-blue-500 text-xl" id="productDetailPrice">$0.00</span>
                <button id="addToCartFromDetail"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    <span data-km="បញ្ចូលក្នុងកន្ត្រក" data-en="Add to Cart">បញ្ចូលក្នុងកន្ត្រក</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Category Products Modal (used for main category clicks) -->
    <div id="categoryProductsModal"
        class="modal fixed inset-0 bg-black bg-opacity-10 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-md mx-auto overflow-hidden max-h-[90vh] flex flex-col">
            <div class="bg-blue-500 text-white py-4 px-6 flex justify-between items-center">
                <h3 class="text-xl font-bold" id="categoryTitle">Category Products</h3>
                <button class="close-modal-btn text-white" data-modal="categoryProductsModal">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div class="p-6 overflow-y-auto flex-grow" id="categoryProducts">
                <!-- Category products will be added here dynamically -->
            </div>
        </div>
    </div>

    <!-- All Categories Modal (New) -->
    <div id="allCategoriesModal"
        class="modal fixed inset-0 bg-black bg-opacity-10 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-lg mx-auto overflow-hidden max-h-[90vh] flex flex-col">
            <div class="bg-gray-700 text-white py-4 px-6 flex justify-between items-center">
                <h3 class="text-xl font-bold" data-km="ប្រភេទផលិតផលទាំងអស់" data-en="All Product Categories">
                    ប្រភេទផលិតផលទាំងអស់</h3>
                <button class="close-modal-btn text-white" data-modal="allCategoriesModal">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div class="p-6 overflow-y-auto flex-grow grid grid-cols-2 gap-4" id="allCategoriesContent">
                <!-- All categories will be rendered here dynamically -->
            </div>
        </div>
    </div>

    <!-- User Profile Modal (New) -->
    <div id="userProfileModal"
        class="modal fixed inset-0 bg-black bg-opacity-10 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-md mx-auto overflow-hidden">
            <div class="bg-blue-500 text-white py-4 px-6 flex justify-between items-center">
                <h3 class="text-xl font-bold" data-km="ព័ត៌មានគណនី" data-en="Account Information">ព័ត៌មានគណនី</h3>
                <button class="close-modal-btn text-white" data-modal="userProfileModal">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="profileUsername">
                        <span data-km="ឈ្មោះអ្នកប្រើប្រាស់" data-en="Username">ឈ្មោះអ្នកប្រើប្រាស់</span>
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-100"
                        id="profileUsername" type="text" value="user" readonly>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="profileEmail">
                        <span data-km="អ៊ីមែល" data-en="Email">អ៊ីមែល</span>
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                        id="profileEmail" type="email" value="user1@example.com">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="profilePhone">
                        <span data-km="លេខទូរស័ព្ទ" data-en="Phone Number">លេខទូរស័ព្ទ</span>
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                        id="profilePhone" type="text" value="012 345 678">
                </div>
                <div class="flex flex-col space-y-3">
                    <button id="updateProfileBtn"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full"
                        data-km="កែប្រែព័ត៌មាន" data-en="Update Profile">
                        កែប្រែព័ត៌មាន
                    </button>
                    <button id="logoutBtn"
                        class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full"
                        data-km="ចាកចេញ" data-en="Log Out">
                        ចាកចេញ
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script>
        // Global variables
        let cart = [];
        let isLoggedIn = false; // Tracks user login status
        let currentLanguage = 'km'; // Default language is Khmer
        let currentUser = {
            username: 'user',
            email: 'user@example.com',
            phone: '012 345 678'
        }; // Placeholder for logged-in user data

        // Product database
        const products = {
            cement: [
                { id: "c1", name: "សុីម៉ងត៍ខ្មែរ", nameEn: "Khmer Cement", price: 7.50, unit: "50KG", description: "សុីម៉ងត៍គុណភាពខ្ពស់ផលិតនៅកម្ពុជា", descriptionEn: "High-quality cement produced in Cambodia", image: "images/cement.jpg", type: "B2C" },
                { id: "c2", name: "សុីម៉ងត៍ថៃ", nameEn: "Thai Cement", price: 8.25, unit: "50KG", description: "សុីម៉ងត៍នាំចូលពីប្រទេសថៃ", descriptionEn: "Imported cement from Thailand", image: "images/thaicement.jpg", type: "B2B" },
                { id: "c3", name: "សុីម៉ងត៍ស", nameEn: "White Cement", price: 12.50, unit: "25KG", description: "សុីម៉ងត៍ពណ៌សសម្រាប់ការងារតុបតែង", descriptionEn: "White cement for decorative work", image: "images/whitecement.jpg", type: "B2C" }
            ],
            bricks: [
                { id: "b1", name: "ឥដ្ឋក្រហម", nameEn: "Red Bricks", price: 0.35, unit: "ផ្ទាំង/piece", description: "ឥដ្ឋក្រហមសម្រាប់សំណង់ទូទៅ", descriptionEn: "Red bricks for general construction", image: "images/redbrick.jpg", type: "B2C" },
                { id: "b2", name: "ឥដ្ឋរូង", nameEn: "Hollow Bricks", price: 0.45, unit: "ផ្ទាំង/piece", description: "ឥដ្ឋរូងសម្រាប់ជញ្ជាំងធំៗ", descriptionEn: "Hollow bricks for large walls", image: "images/hallowbrick.jpg", type: "B2B" }
            ],
            tools: [
                { id: "t1", name: "ឧបករណ៍ជាង", nameEn: "Tool Set", price: 45.00, unit: "ឈុតគ្រឿង 10/10-piece set", description: "ឧបករណ៍ជាងសំណង់ចំនួន 10 មុខ", descriptionEn: "10-piece construction tool set", image: "images/things.jpg", type: "B2C" },
                { id: "t2", name: "ញញួរ", nameEn: "Hammer", price: 8.75, unit: "ដើម/piece", description: "ញញួរធ្ងន់សម្រាប់ការងារសំណង់", descriptionEn: "Heavy-duty hammer for construction work", image: "images/hammer.jpg", type: "B2C" }
            ],
            steel: [
                { id: "s1", name: "ដែកម៉ាក់", nameEn: "Thai Steel", price: 12.75, unit: "12mm x 12m", description: "ដែកម៉ាក់គុណភាពល្អ", descriptionEn: "High-quality Thai steel", image: "images/Metal.jpg", type: "B2B" },
                { id: "s2", name: "ដែកគោល", nameEn: "Nails", price: 3.50, unit: "1KG", description: "ដែកគោលគ្រប់ទំហំ", descriptionEn: "Nails of various sizes", image: "images/nail.jpg", type: "B2C" }
            ],
            fabric: [
                { id: "f1", name: "ក្រណាត់ការពារផ្ទះ", nameEn: "Protective Fabric", price: 2.25, unit: "1m²", description: "ក្រណាត់ការពារផ្ទះពេលសាងសង់", descriptionEn: "Protective fabric for construction sites", image: "images/fabric.jpg", type: "B2B" }
            ],
            other: [
                { id: "o1", name: "ក្បឿងដំបូល", nameEn: "Roof Tiles", price: 5.25, unit: "1m x 2m", description: "ក្បឿងដំបូលគុណភាពល្អ ធន់នឹងកំដៅ", descriptionEn: "High-quality roof tiles, heat resistant", image: "images/roof.jpg", type: "B2C" },
                { id: "o2", name: "ថ្នាំលាបជញ្ជាំង", nameEn: "Wall Paint", price: 15.00, unit: "5L", description: "ថ្នាំលាបជញ្ជាំងគុណភាពខ្ពស់", descriptionEn: "High-quality wall paint", image: "images/paint.jpg", type: "B2C" }
            ]
        };

        // DOM Elements
        const searchBtn = document.getElementById('searchBtn');
        const searchBar = document.getElementById('searchBar');
        const userBtn = document.getElementById('userBtn'); // Top right user icon
        const cartBtn = document.getElementById('cartBtn'); // Top right cart icon
        const categoriesNavBtn = document.getElementById('categoriesNavBtn'); // Bottom nav category button
        const cartNavBtn = document.getElementById('cartNavBtn'); // Bottom nav cart button
        const accountNavBtn = document.getElementById('accountNavBtn'); // Bottom nav account button
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const cartModal = document.getElementById('cartModal');
        const checkoutSuccessModal = document.getElementById('checkoutSuccessModal');
        const productDetailModal = document.getElementById('productDetailModal');
        const categoryProductsModal = document.getElementById('categoryProductsModal');
        const allCategoriesModal = document.getElementById('allCategoriesModal'); // New All Categories Modal
        const userProfileModal = document.getElementById('userProfileModal'); // New User Profile Modal
        const showRegisterBtn = document.getElementById('showRegisterBtn');
        const showLoginBtn = document.getElementById('showLoginBtn');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const continueShoppingBtn = document.getElementById('continueShoppingBtn');
        const cartItemsContainer = document.getElementById('cartItems');
        const emptyCartMessage = document.getElementById('emptyCart');
        const cartTotal = document.getElementById('cartTotal');
        const cartCount = document.getElementById('cartCount');
        const b2cBtn = document.getElementById('b2cBtn');
        const b2bBtn = document.getElementById('b2bBtn');
        const b2bSection = document.getElementById('b2bSection');
        const langToggle = document.getElementById('langToggle');
        const currentLangSpan = document.getElementById('currentLang');
        const productDetailTitle = document.getElementById('productDetailTitle');
        // Get the new elements for the product detail modal content
        const modalProductMainImage = document.getElementById('modalProductMainImage');
        const modalProductName = document.getElementById('modalProductName');
        const modalProductSpec = document.getElementById('modalProductSpec');
        const modalProductDescription = document.getElementById('modalProductDescription');
        const productDetailPrice = document.getElementById('productDetailPrice');
        const addToCartFromDetailBtn = document.getElementById('addToCartFromDetail');
        const categoryTitle = document.getElementById('categoryTitle');
        const categoryProductsContainer = document.getElementById('categoryProducts');
        const notificationContainer = document.getElementById('notificationContainer');
        const allCategoriesContent = document.getElementById('allCategoriesContent'); // Content area for All Categories Modal
        const profileUsernameInput = document.getElementById('profileUsername'); // User profile inputs
        const profileEmailInput = document.getElementById('profileEmail');
        const profilePhoneInput = document.getElementById('profilePhone');
        const updateProfileBtn = document.getElementById('updateProfileBtn');
        const logoutBtn = document.getElementById('logoutBtn');


        // --- Utility Functions ---

        /**
         * Hides a given modal element.
         * @param {HTMLElement} modalElement The modal DOM element to hide.
         */
        function hideModal(modalElement) {
            modalElement.classList.add('hidden');
            // Remove click listener from outside modal when hidden
            modalElement.removeEventListener('click', dismissModalOutside);
        }

        /**
         * Shows a given modal element.
         * @param {HTMLElement} modalElement The modal DOM element to show.
         */
        function showModal(modalElement) {
            modalElement.classList.remove('hidden');
            // Add click listener to dismiss modal when clicking outside
            modalElement.addEventListener('click', dismissModalOutside);
        }

        /**
         * Handles clicking outside a modal to dismiss it.
         * @param {Event} event The click event.
         */
        function dismissModalOutside(event) {
            // Check if the click was directly on the modal backdrop (not its content)
            if (event.target.classList.contains('modal')) {
                hideModal(event.target);
            }
        }

        /**
         * Shows a temporary notification message.
         * @param {string} message The message to display.
         * @param {string} type The type of notification (e.g., 'success', 'error', 'info').
         */
        function showNotification(message, type = 'info') {
            const notificationDiv = document.createElement('div');
            notificationDiv.className = `p-3 rounded-lg shadow-md text-white transition transform duration-300 ease-out translate-x-full opacity-0`;
            notificationDiv.style.pointerEvents = 'auto'; // Make notification clickable/selectable

            let bgColor = 'bg-blue-500';
            if (type === 'success') {
                bgColor = 'bg-green-500';
            } else if (type === 'error') {
                bgColor = 'bg-red-500';
            } else if (type === 'warning') {
                bgColor = 'bg-yellow-500';
            }

            notificationDiv.classList.add(bgColor);
            notificationDiv.textContent = message;

            notificationContainer.appendChild(notificationDiv);

            // Animate in
            setTimeout(() => {
                notificationDiv.classList.remove('translate-x-full', 'opacity-0');
            }, 50); // Small delay to ensure transition applies

            // Animate out and remove after a few seconds
            setTimeout(() => {
                notificationDiv.classList.add('translate-x-full', 'opacity-0');
                notificationDiv.addEventListener('transitionend', () => notificationDiv.remove());
            }, 3000); // Notification disappears after 3 seconds
        }

        /**
         * Attaches event listeners to dynamically rendered product cards and their add-to-cart buttons.
         * This function should be called after products are loaded into the DOM.
         * @param {HTMLElement} container The container element where products are rendered.
         */
        function attachProductEventListeners(container) {
            // Attach listeners to "Add to Cart" buttons
            container.querySelectorAll('.add-to-cart').forEach(button => {
                // Remove existing listener to prevent duplicates
                button.removeEventListener('click', handleAddToCartButtonClick);
                button.addEventListener('click', handleAddToCartButtonClick);
            });

            // Attach listeners to product cards for detail view
            container.querySelectorAll('.product-card').forEach(card => {
                // Remove existing listener to prevent duplicates
                card.removeEventListener('click', handleProductCardClick);
                card.addEventListener('click', handleProductCardClick);
            });
            // Attach listeners to "Add to Cart" buttons within category products modal
            if (categoryProductsContainer) { // Check if element exists
                categoryProductsContainer.querySelectorAll('.add-to-cart').forEach(button => {
                    button.removeEventListener('click', handleAddToCartButtonClick); // Prevent double-listening
                    button.addEventListener('click', handleAddToCartButtonClick);
                });
            }
        }

        // --- Core Application Logic ---

        /**
         * Handles click event for 'Add to Cart' buttons.
         * @param {Event} event The click event.
         */
        function handleAddToCartButtonClick(event) {
            // Prevent the product card click event from firing when the button inside it is clicked
            event.stopPropagation();

            if (!isLoggedIn) {
                showNotification(currentLanguage === 'km' ? 'សូមចូលគណនីដើម្បីបន្ថែមទំនិញ' : 'Please log in to add items to cart', 'warning');
                showModal(loginModal);
                return;
            }

            const button = event.currentTarget; // Use currentTarget to get the element the listener is attached to
            const id = button.getAttribute('data-id');
            const name = button.getAttribute('data-name');
            const nameEn = button.getAttribute('data-name-en');
            const price = parseFloat(button.getAttribute('data-price'));

            addToCart(id, name, nameEn, price);
        }

        /**
         * Handles click event for product cards to show product details.
         * @param {Event} event The click event.
         */
        function handleProductCardClick(event) {
            // Check if the click originated from the add-to-cart button, if so, do nothing.
            if (event.target.closest('.add-to-cart')) {
                return;
            }

            const card = event.currentTarget;
            const id = card.getAttribute('data-id'); // Get product ID directly from the card

            showProductDetail(id);
        }


        /**
         * Toggles the visibility of the search bar.
         */
        function toggleSearchBar() {
            searchBar.classList.toggle('hidden');
            // If showing search bar, focus on input
            if (!searchBar.classList.contains('hidden')) {
                document.getElementById('searchInput').focus();
            }
        }

        /**
         * Displays the login modal.
         */
        function showLoginModal() {
            if (isLoggedIn) {
                showNotification(currentLanguage === 'km' ? 'អ្នកបានចូលគណនីរួចហើយ' : 'You are already logged in', 'info');
                return;
            }
            hideModal(registerModal); // Ensure register modal is hidden
            showModal(loginModal);
        }

        /**
         * Displays the registration modal.
         */
        function showRegisterModal() {
            hideModal(loginModal); // Ensure login modal is hidden
            showModal(registerModal);
        }

        /**
         * Displays the cart modal and updates its content.
         */
        function showCartModal() {
            showModal(cartModal);
            updateCartDisplay();
        }

        /**
         * Hides the cart modal.
         */
        function hideCartModal() {
            hideModal(cartModal);
        }

        /**
         * Hides the checkout success modal.
         */
        function hideCheckoutSuccessModal() {
            hideModal(checkoutSuccessModal);
        }

        /**
         * Handles the login process.
         */
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // Simple validation
            if (username === 'user' && password === '123') {
                isLoggedIn = true;
                currentUser.username = username; // Update current user
                hideModal(loginModal);
                showNotification(currentLanguage === 'km' ? 'ចូលគណនីបានជោគជ័យ!' : 'Login successful!', 'success');
                updateUIForLoginStatus();
            } else {
                showNotification(currentLanguage === 'km' ? 'ឈ្មោះអ្នកប្រើប្រាស់ ឬលេខសម្ងាត់មិនត្រឹមត្រូវ' : 'Invalid username or password', 'error');
            }
        }

        /**
         * Handles the registration process.
         */
        function handleRegister() {
            const fullName = document.getElementById('fullName').value;
            const phoneNumber = document.getElementById('phoneNumber').value;
            const regEmail = document.getElementById('regEmail').value;
            const regPassword = document.getElementById('regPassword').value;

            // Simple validation
            if (fullName && phoneNumber && regEmail && regPassword) {
                // In a real app, this would send data to a server
                showNotification(currentLanguage === 'km' ? 'ចុះឈ្មោះបានជោគជ័យ! សូមចូលគណនី' : 'Registration successful! Please log in', 'success');
                hideModal(registerModal);
                showModal(loginModal); // Automatically show login after successful registration
            } else {
                showNotification(currentLanguage === 'km' ? 'សូមបំពេញព័ត៌មានទាំងអស់' : 'Please fill in all fields', 'error');
            }
        }

        /**
         * Adds a product to the cart or increments its quantity.
         * @param {string} id Product ID.
         * @param {string} name Product name (Khmer).
         * @param {string} nameEn Product name (English).
         * @param {number} price Product price.
         */
        function addToCart(id, name, nameEn, price) {
            const existingItem = cart.find(item => item.id === id);

            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ id, name, nameEn, price, quantity: 1 });
            }
            showNotification(currentLanguage === 'km' ? 'បានបន្ថែមទៅក្នុងកន្ត្រក' : 'Added to cart', 'success');
            updateCartDisplay();
        }

        /**
         * Updates the display of the shopping cart.
         */
        function updateCartDisplay() {
            cartItemsContainer.innerHTML = ''; // Clear current cart display
            let total = 0;

            if (cart.length === 0) {
                emptyCartMessage.classList.remove('hidden');
                checkoutBtn.disabled = true;
            } else {
                emptyCartMessage.classList.add('hidden');
                checkoutBtn.disabled = false;
                cart.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;

                    const cartItemDiv = document.createElement('div');
                    cartItemDiv.className = 'flex justify-between items-center py-2 border-b border-gray-100';
                    cartItemDiv.innerHTML = `
                        <div>
                            <p class="font-medium">${currentLanguage === 'km' ? item.name : item.nameEn}</p>
                            <p class="text-sm text-gray-500">$${item.price.toFixed(2)} x ${item.quantity}</p>
                        </div>
                        <div class="flex items-center">
                            <button class="remove-from-cart-btn bg-red-500 text-white p-1 rounded-full text-xs w-6 h-6 flex items-center justify-center mr-2" data-index="${index}">-</button>
                            <button class="add-more-to-cart-btn bg-blue-500 text-white p-1 rounded-full text-xs w-6 h-6 flex items-center justify-center" data-index="${index}">+</button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(cartItemDiv);
                });
            }

            cartTotal.textContent = `$${total.toFixed(2)}`;
            cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);

            // Attach event listeners for quantity buttons in the cart modal
            cartItemsContainer.querySelectorAll('.remove-from-cart-btn').forEach(button => {
                button.addEventListener('click', removeFromCart);
            });
            cartItemsContainer.querySelectorAll('.add-more-to-cart-btn').forEach(button => {
                button.addEventListener('click', addMoreToCart);
            });
        }

        /**
         * Removes an item from the cart or decreases its quantity.
         * @param {Event} event The click event.
         */
        function removeFromCart(event) {
            const index = parseInt(event.currentTarget.getAttribute('data-index'));
            if (cart[index].quantity > 1) {
                cart[index].quantity--;
            } else {
                cart.splice(index, 1); // Remove item if quantity is 1
            }
            updateCartDisplay();
        }

        /**
         * Adds more quantity to an item in the cart.
         * @param {Event} event The click event.
         */
        function addMoreToCart(event) {
            const index = parseInt(event.currentTarget.getAttribute('data-index'));
            cart[index].quantity++;
            updateCartDisplay();
        }

        /**
         * Handles the checkout process.
         */
        function handleCheckout() {
            if (cart.length === 0) {
                showNotification(currentLanguage === 'km' ? 'កន្ត្រកទំនិញទំនេរ' : 'Cart is empty', 'warning');
                return;
            }

            // In a real app, this would process the order
            cart = []; // Clear cart after checkout
            hideModal(cartModal);
            showModal(checkoutSuccessModal);
            updateCartDisplay(); // Update display after clearing cart
        }

        /**
         * Displays the product detail modal with information for a specific product.
         * @param {string} id Product ID.
         */
        function showProductDetail(id) {
            let product = null;
            // Find product details from the global 'products' database
            for (const category in products) {
                const found = products[category].find(p => p.id === id);
                if (found) {
                    product = found;
                    break;
                }
            }

            if (!product) {
                console.error('Product not found for ID:', id);
                showNotification(currentLanguage === 'km' ? 'មិនមានព័ត៌មានផលិតផលទេ' : 'Product information not available', 'error');
                return;
            }

            // Update modal image
            modalProductMainImage.src = product.image || 'https://placehold.co/600x400/E5E7EB/4B5563?text=No+Image'; // Fallback
            modalProductMainImage.alt = currentLanguage === 'km' ? product.name : product.nameEn;

            // Update modal text content
            productDetailTitle.textContent = currentLanguage === 'km' ? product.name : product.nameEn; // Main modal title
            modalProductName.textContent = currentLanguage === 'km' ? product.name : product.nameEn;
            modalProductSpec.textContent = product.unit;
            modalProductDescription.textContent = currentLanguage === 'km' ? product.description : product.descriptionEn;
            productDetailPrice.textContent = `$${product.price.toFixed(2)}`;

            // Set data attributes for the 'Add to Cart' button in the detail view
            addToCartFromDetailBtn.setAttribute('data-id', product.id);
            addToCartFromDetailBtn.setAttribute('data-name', product.name);
            addToCartFromDetailBtn.setAttribute('data-name-en', product.nameEn);
            addToCartFromDetailBtn.setAttribute('data-price', product.price);

            showModal(productDetailModal);
        }

        /**
         * Hides the product detail modal.
         */
        function hideProductDetailModal() {
            hideModal(productDetailModal);
        }

        /**
         * Adds the product currently shown in the detail view to the cart.
         */
        function addToCartFromDetailView() {
            if (!isLoggedIn) {
                showNotification(currentLanguage === 'km' ? 'សូមចូលគណនីដើម្បីបន្ថែមទំនិញ' : 'Please log in to add items to cart', 'warning');
                hideModal(productDetailModal);
                showModal(loginModal);
                return;
            }

            const id = addToCartFromDetailBtn.getAttribute('data-id');
            const name = addToCartFromDetailBtn.getAttribute('data-name');
            const nameEn = addToCartFromDetailBtn.getAttribute('data-name-en');
            const price = parseFloat(addToCartFromDetailBtn.getAttribute('data-price'));

            addToCart(id, name, nameEn, price);
            hideModal(productDetailModal); // Close detail modal after adding to cart
        }

        /**
         * Displays products for a selected category in a modal.
         * @param {string} category The category ID.
         */
        function showCategoryProducts(category) {
            const categoryData = products[category] || [];

            // Set category title based on language
            let categoryName = '';
            switch (category) {
                case 'cement': categoryName = currentLanguage === 'km' ? 'សុីម៉ងត៍' : 'Cement'; break;
                case 'bricks': categoryName = currentLanguage === 'km' ? 'ឥដ្ឋ' : 'Bricks'; break;
                case 'tools': categoryName = currentLanguage === 'km' ? 'ឧបករណ៍' : 'Tools'; break;
                case 'steel': categoryName = currentLanguage === 'km' ? 'ដែក' : 'Steel'; break;
                case 'fabric': categoryName = currentLanguage === 'km' ? 'ក្រណាត់' : 'Fabric'; break;
                case 'other': categoryName = currentLanguage === 'km' ? 'ផ្សេងៗ' : 'Others'; break;
                default: categoryName = currentLanguage === 'km' ? 'ផលិតផល' : 'Products';
            }
            categoryTitle.textContent = categoryName;

            // Render products for the selected category
            let productsHTML = '';
            if (categoryData.length === 0) {
                productsHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <p>${currentLanguage === 'km' ? 'មិនមានផលិតផលនៅក្នុងប្រភេទនេះទេ' : 'No products in this category'}</p>
                    </div>
                `;
            } else {
                productsHTML = `<div class="grid grid-cols-1 gap-4">`;
                categoryData.forEach(product => {
                    productsHTML += `
                        <div class="product-card bg-white rounded-lg shadow overflow-hidden cursor-pointer"
                            data-id="${product.id}"
                            data-name-km="${product.name}"
                            data-name-en="${product.nameEn}"
                            data-price="${product.price}"
                            data-spec="${product.unit}"
                            data-image="${product.image || ''}"
                            data-description-km="${product.description}"
                            data-description-en="${product.descriptionEn}">
                            <div class="h-32 bg-gray-200 flex items-center justify-center">
                                <img src="${product.image || 'https://placehold.co/128x128/E5E7EB/4B5563?text=No+Image'}" 
                                     alt="${product.nameEn}" 
                                     class="w-full h-full object-cover">
                            </div>
                            <div class="p-4">
                                <h3 class="font-medium mb-1">${currentLanguage === 'km' ? product.name : product.nameEn}</h3>
                                <p class="text-gray-500 text-sm mb-2">${product.unit}</p>
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-blue-500">$${product.price.toFixed(2)}</span>
                                    <button class="add-to-cart bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-sm"
                                        data-id="${product.id}"
                                        data-name="${product.name}"
                                        data-name-en="${product.nameEn}"
                                        data-price="${product.price}">
                                        ${currentLanguage === 'km' ? 'បញ្ចូលក្នុងកន្ត្រក' : 'Add to Cart'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                productsHTML += `</div>`;
            }
            categoryProductsContainer.innerHTML = productsHTML;
            showModal(categoryProductsModal);
            // Re-attach listeners for the newly added products in the category modal
            attachProductEventListeners(categoryProductsContainer);
        }

        /**
         * Hides the category products modal.
         */
        function hideCategoryProductsModal() {
            hideModal(categoryProductsModal);
        }

        /**
         * Displays all categories in a modal.
         */
        function showAllCategoriesModal() {
            let categoriesHTML = '';
            const categoriesIconMap = { // Mapping for category icons
                cement: { km: "សុីម៉ងត៍", en: "Cement", svg: `<svg class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>` },
                bricks: { km: "ឥដ្ឋ", en: "Bricks", svg: `<svg class="h-8 w-8 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>` },
                tools: { km: "ឧបករណ៍", en: "Tools", svg: `<svg class="h-8 w-8 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>` },
                steel: { km: "ដែក", en: "Steel", svg: `<svg class="h-8 w-8 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg>` },
                fabric: { km: "ក្រណាត់", en: "Fabric", svg: `<svg class="h-8 w-8 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"></path></svg>` },
                other: { km: "ផ្សេងៗ", en: "Others", svg: `<svg class="h-8 w-8 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path></svg>` }
            };

            for (const categoryKey in products) {
                const categoryInfo = categoriesIconMap[categoryKey]; // Use the mapping for direct access
                const kmName = categoryInfo ? categoryInfo.km : 'Unknown';
                const enName = categoryInfo ? categoryInfo.en : 'Unknown';
                const iconSvg = categoryInfo ? categoryInfo.svg : `<svg class="h-8 w-8 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path></svg>`;


                categoriesHTML += `
                    <div class="category-card bg-white rounded-lg shadow p-4 text-center cursor-pointer" data-category="${categoryKey}">
                        <div class="bg-gray-100 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-3">
                            ${iconSvg}
                        </div>
                        <h3 class="font-medium">${currentLanguage === 'km' ? kmName : enName}</h3>
                    </div>
                `;
            }
            allCategoriesContent.innerHTML = categoriesHTML;
            showModal(allCategoriesModal);

            // Re-attach event listeners for category cards inside the new modal
            allCategoriesContent.querySelectorAll('.category-card').forEach(card => {
                card.addEventListener('click', function () {
                    const category = this.getAttribute('data-category');
                    hideModal(allCategoriesModal); // Hide all categories modal
                    showCategoryProducts(category); // Show products for selected category
                });
            });
        }


        /**
         * Hides the all categories modal.
         */
        function hideAllCategoriesModal() {
            hideModal(allCategoriesModal);
        }

        /**
         * Switches the view to B2C mode.
         */
        function switchToB2C() {
            b2cBtn.classList.remove('bg-gray-200', 'text-gray-700');
            b2cBtn.classList.add('bg-blue-500', 'text-white');
            b2bBtn.classList.remove('bg-blue-500', 'text-white');
            b2bBtn.classList.add('bg-gray-200', 'text-gray-700');
            b2bSection.classList.add('hidden');
        }

        /**
         * Switches the view to B2B mode.
         */
        function switchToB2B() {
            b2bBtn.classList.remove('bg-gray-200', 'text-gray-700');
            b2bBtn.classList.add('bg-blue-500', 'text-white');
            b2cBtn.classList.remove('bg-blue-500', 'text-white');
            b2cBtn.classList.add('bg-gray-200', 'text-gray-700');
            b2bSection.classList.remove('hidden');
        }

        /**
         * Toggles the language between Khmer and English.
         */
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'km' ? 'en' : 'km';
            updateContentLanguage();
        }

        /**
         * Updates all language-dependent text content on the page.
         */
        function updateContentLanguage() {
            // Update lang toggle button text
            currentLangSpan.textContent = currentLanguage === 'km' ? 'ខ្មែរ' : 'English';
            document.querySelector('#langToggle span.text-gray-400').textContent = currentLanguage === 'km' ? 'Eng' : 'ខ្មែរ';

            // Update all elements with data-km and data-en attributes
            document.querySelectorAll('[data-km]').forEach(element => {
                const kmText = element.getAttribute('data-km');
                const enText = element.getAttribute('data-en');
                // Ensure textContent is only updated if attribute is present to avoid errors
                if (kmText !== null && enText !== null) {
                    element.textContent = currentLanguage === 'km' ? kmText : enText;
                }
            });

            // Update product detail modal if open
            if (!productDetailModal.classList.contains('hidden')) {
                // Re-render the product detail content to update text
                // Retrieve the product ID from the currently displayed product in the modal
                const currentProductId = addToCartFromDetailBtn.getAttribute('data-id');
                if (currentProductId) {
                    showProductDetail(currentProductId);
                }
            }

            // Update category products modal if open
            if (!categoryProductsModal.classList.contains('hidden')) {
                const currentCategoryTitleElement = categoryProductsModal.querySelector('#categoryTitle');
                if (currentCategoryTitleElement) {
                    let categoryKeyToUpdate = '';
                    // Find the category key based on the current displayed title in the modal
                    for (const key in products) {
                        const kmName = categoriesIconMap[key]?.km || '';
                        const enName = categoriesIconMap[key]?.en || '';

                        if ((currentLanguage === 'km' && kmName === currentCategoryTitleElement.textContent) ||
                            (currentLanguage === 'en' && enName === currentCategoryTitleElement.textContent)) {
                            categoryKeyToUpdate = key;
                            break;
                        }
                    }
                    if (categoryKeyToUpdate) {
                        showCategoryProducts(categoryKeyToUpdate);
                    }
                }
            }

            // Update all categories modal if open
            if (!allCategoriesModal.classList.contains('hidden')) {
                showAllCategoriesModal(); // Re-render to update language
            }

            // Update cart display text
            updateCartDisplay();

            // Update user profile modal if open
            if (!userProfileModal.classList.contains('hidden')) {
                showUserProfileModal(); // Re-render to update language
            }
        }

        /**
         * Updates UI elements based on login status.
         */
        function updateUIForLoginStatus() {
            // Placeholder: In a real app, this would show/hide user profile options, etc.
            if (isLoggedIn) {
                console.log("User is logged in as:", currentUser.username);
                // Optionally update top-right user button or display username
            } else {
                console.log("User is logged out.");
                // Optionally revert top-right user button to default or hide user info
            }
        }

        /**
         * Displays the user profile modal with current user data.
         */
        function showUserProfileModal() {
            if (!isLoggedIn) {
                showNotification(currentLanguage === 'km' ? 'សូមចូលគណនីដើម្បីមើលព័ត៌មាន' : 'Please log in to view account information', 'warning');
                showModal(loginModal);
                return;
            }

            profileUsernameInput.value = currentUser.username;
            profileEmailInput.value = currentUser.email;
            profilePhoneInput.value = currentUser.phone;

            showModal(userProfileModal);
        }

        /**
         * Handles the update profile action.
         */
        function handleUpdateProfile() {
            // In a real app, this would send updated data to a server
            currentUser.email = profileEmailInput.value;
            currentUser.phone = profilePhoneInput.value;
            showNotification(currentLanguage === 'km' ? 'ព័ត៌មានគណនីបានកែប្រែដោយជោគជ័យ' : 'Account information updated successfully!', 'success');
            hideModal(userProfileModal);
        }

        /**
         * Handles the logout action.
         */
        function handleLogout() {
            isLoggedIn = false;
            cart = []; // Clear cart on logout
            hideModal(userProfileModal);
            updateCartDisplay(); // Update cart count
            showNotification(currentLanguage === 'km' ? 'អ្នកបានចាកចេញពីគណនីហើយ' : 'You have been logged out', 'info');
            updateUIForLoginStatus();
        }

        /**
         * Initializes the application by attaching all necessary event listeners and setting initial UI state.
         */
        function initApp() {
            // Attach global event listeners (for static elements)
            searchBtn.addEventListener('click', toggleSearchBar);
            userBtn.addEventListener('click', showLoginModal); // Top right user button still opens login
            cartBtn.addEventListener('click', showCartModal); // Top right cart button still opens cart

            // Bottom Navigation buttons
            categoriesNavBtn.addEventListener('click', showAllCategoriesModal); // Show all categories modal
            cartNavBtn.addEventListener('click', showCartModal); // Bottom nav cart button opens cart modal
            accountNavBtn.addEventListener('click', showUserProfileModal); // Bottom nav account button opens user profile

            // Login/Register modal interactions
            showRegisterBtn.addEventListener('click', showRegisterModal);
            showLoginBtn.addEventListener('click', showLoginModal);
            loginBtn.addEventListener('click', handleLogin);
            registerBtn.addEventListener('click', handleRegister);

            // Cart and Checkout
            checkoutBtn.addEventListener('click', handleCheckout);
            continueShoppingBtn.addEventListener('click', hideCheckoutSuccessModal);
            addToCartFromDetailBtn.addEventListener('click', addToCartFromDetailView);

            // B2B/B2C toggle
            b2cBtn.addEventListener('click', switchToB2C);
            b2bBtn.addEventListener('click', switchToB2B);

            // Language toggle
            langToggle.addEventListener('click', toggleLanguage);

            // User Profile actions
            updateProfileBtn.addEventListener('click', handleUpdateProfile);
            logoutBtn.addEventListener('click', handleLogout);

            // Attach event listeners for modal close buttons
            document.querySelectorAll('.close-modal-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const modalId = this.getAttribute('data-modal');
                    const modalElement = document.getElementById(modalId);
                    if (modalElement) {
                        hideModal(modalElement);
                    }
                });
            });

            // Attach product-related event listeners for initial featured products
            attachProductEventListeners(document.getElementById('featuredProductsContainer'));

            // Attach event listeners for main category cards (already present)
            document.querySelectorAll('.category-card').forEach(card => {
                card.addEventListener('click', function () {
                    const category = this.getAttribute('data-category');
                    showCategoryProducts(category);
                });
            });

            // Initial UI updates
            updateCartDisplay(); // Ensure cart count is correct on load
            switchToB2C(); // Set default customer type to B2C
            updateContentLanguage(); // Apply default language
            updateUIForLoginStatus(); // Update UI based on initial login status (currently false)
        }

        // Initialize the app when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>

</html>
